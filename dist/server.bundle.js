!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("moment-timezone")},function(e,t){e.exports=require("firebase")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("node-cron")},function(e,t){e.exports=require("@babel/polyfill")},function(e,t,n){"use strict";n.r(t);n(7);var r=n(1),o=n.n(r),a=n(0),u=n(3);Object(a.config)();var i=process.env,c={apiKey:i.APIKEY,authDomain:i.AUTHDOMAIN,databaseURL:i.DATABASEURL,projectId:i.PROJECTID,storageBucket:"",messagingSenderId:i.MESSAGINGSENDERID,appId:i.APPID},s=u.initializeApp(c),l=n(4),d=n.n(l),p=n(2),f=n.n(p);function m(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function u(e){m(a,r,o,u,i,"next",e)}function i(e){m(a,r,o,u,i,"throw",e)}u(void 0)})}}Object(a.config)();var b=process.env,v=b.EMAIL_USER,g=b.EMAIL_PASSWORD,y=b.CC,x=b.TO_CONSOLIDATE,w=b.TO_INMEDIATE,k=function(e){var t=f()(e).tz("America/Managua").format("YYYY-MM-DD").split("-"),n=t[1],r=t[2],o=t[0];return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[o,n,r].join("-")},R=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=f()(e).tz("America/Managua").format("YYYY-M-DD-HH:mm"),r=n.split("-"),o=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],a=r[0],u=o[r[1]-1],i=r[2],c=r[3],s=i+" "+u+" "+a+(t?" "+c:"");return s},D=d.a.createTransport({service:"gmail",secure:!1,auth:{user:v,pass:g},tls:{rejectUnauthorized:!1}}),E=function(){var e=h(regeneratorRuntime.mark(function e(t){var n,r,o,a,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.to,n=t.nombre,r=t.telefono,o=t.cedula,a=t.email,u=t.tipoDeGestion,e.prev=1,i={from:v,to:w,subject:u,cc:y,html:"<table>\n                <tr>\n                    <td>Nombre</td>\n                    <td>".concat(n,"</td>\n                </tr>\n                <tr>\n                    <td>Telefono</td>\n                    <td>").concat(r,"</td>\n                </tr>\n                <tr>\n                    <td># de cedula</td>\n                    <td>").concat(o,"</td>\n                </tr>\n                <tr>\n                    <td>Email</td>\n                    <td>").concat(a,"</td>\n                </tr>\n                <tr>\n                    <td>Tipo de consulta</td>\n                    <td>").concat(u,"</td>\n                </tr>\n                <Table>\n                ")},e.next=5,D.sendMail(i);case 5:return e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=h(regeneratorRuntime.mark(function e(t,n){var r,o,a,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r="",0===t.length)r='<tr>\n                 <td style="padding: 1%;" colspan="6">Sin datos</td>\n                </tr>';else for("#ffffff",o="No proporcionado",a=0;a<t.length;a++)r+='<tr style="border-bottom: 1px solid #dee2e6; background:'+(a%2==0?"#dee2e6":"#ffffff")+'">\n                    <td>'+(a+1)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].nombre?t[a].nombre:o)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].cedula?t[a].cedula:o)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].telefono?t[a].telefono:o)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].tipoDeGestion?t[a].tipoDeGestion:o)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].email?t[a].email:o)+'</td>\n                    <td style="padding: 0.6%; word-break: break-all">'+("null"!==t[a].fechaLog?t[a].fechaLog:o)+"</td>\n                   </tr>";return u='\n    <html lang="en">\n        <head>\n            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1">\n            <meta http-equiv="X-UA-Compatible" content="IE=edge">\n            <title></title>\n            <style type="text/css">\n            </style>    \n        </head>\n        <body style="margin:0; padding:0; background-color:#F2F2F2;">\n        <center>\n            <h2 style="margin-bottom: 2%; margin-top: 2%"> '+n+": "+t.length+' registros</h2>\n            <table width="100%" border="0" cellpadding="1" cellspacing="2" bgcolor="whiteSmoke">\n                <thead>\n                    <tr style=\'border: 1px\'>\n                        <th style="min-width: 35px" scope="col">#</th>\n                        <th scope="col">Nombre</th>\n                        <th scope="col">Cédula</th>\n                        <th scope="col">Teléfono</th>\n                        <th scope="col">Gestión</th>\n                        <th scope="col">Email</th>\n                        <th scope="col">Fecha</th>\n                    </tr>\n                </thead>\n                <tbody>\n                '+r+"\n                </tbody>\n            </table>\n        </center>\n        </body>\n    </html>",i={from:v,to:x,subject:"ChatBot Consolidate - "+n,cc:y,html:u},e.next=7,D.sendMail(i);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=h(regeneratorRuntime.mark(function e(t){var n,r,o,a,u,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=void 0!==t?new Date(t):new Date,r=k(n),o=R(n,!1),a=[],u=s.database().ref("/logChatBot/"+r),i={},e.next=9,u.once("value").then(function(e){e.forEach(function(e){void 0!==(i=e.val())&&"testingChatBot"!==i.nombre&&a.push(i)})});case 9:return e.next=11,O(a,o);case 11:return c=e.sent,e.next=14,A(a.length,c);case 14:return e.abrupt("return",c);case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",!1);case 20:case"end":return e.stop()}},e,null,[[0,17]])}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=h(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=s.database().ref("/nodeCron"),o=new Date,a=R(o),e.next=6,r.child(a).push({totalData:t,sendMail:n,toEmail:x});case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t,n){return e.apply(this,arguments)}}();function S(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function T(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function u(e){S(a,r,o,u,i,"next",e)}function i(e){S(a,r,o,u,i,"throw",e)}u(void 0)})}}var M=o.a.Router();M.post("/sendData",function(){var e=T(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t.headers.authorization||null)===process.env.SECRET){e.next=3;break}return e.abrupt("return",n.status(401).json({error:"No credentials sent!"}));case 3:if(r={nombre:t.body.nombre||null,telefono:t.body.telefono||null,cedula:t.body.cedula||null,tipoDeGestion:t.body.tipoDeGestion||null,email:t.body.email||null,to:t.body.to||null},"testingChatBot"===t.body.nombre){e.next=10;break}return e.next=7,E(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=!1;case 11:return o=e.t0,e.next=14,C(r);case 14:n.status(200).json({mail:o});case 15:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),M.post("/dailyReport",function(){var e=T(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.body.fecha,(t.headers.authorization||null)+"_dailyReport"===process.env.SECRET){e.next=4;break}return e.abrupt("return",n.status(401).json({error:"No credentials sent!"}));case 4:return e.next=6,j(r);case 6:o=e.sent,n.status(200).json({mail:o});case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());var C=function(){var e=T(regeneratorRuntime.mark(function e(t){var n,r,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.database().ref("/logChatBot"),r=new Date,o=r.getTime(),a=k(r),u=R(r),e.next=7,n.child(a).push({nombre:t.nombre,telefono:t.telefono,cedula:t.cedula,tipoDeGestion:t.tipoDeGestion,email:t.email,to:t.to,fechaLog:u,timestamp:o});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),P=M,I=n(5),N=n(6),_=n.n(N);function G(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function q(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function u(e){G(a,r,o,u,i,"next",e)}function i(e){G(a,r,o,u,i,"throw",e)}u(void 0)})}}Object(a.config)();var z=process.env,Y=z.PORT,B=z.CRON_JOB,L=o()();L.use(o.a.json()),_.a.schedule(B,q(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("cron "+e.t0);case 8:case"end":return e.stop()}},e,null,[[0,5]])})),{scheduled:!0,timezone:"America/Guatemala"}),L.use("/api/bot",P),Object(I.createServer)(L).listen({port:Y},function(){return console.log("Example app listening on port ".concat(Y,"!"))})}]);